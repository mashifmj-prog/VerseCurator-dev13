<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerseCurator - Phase 2.3 Audio & Enhancement</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== CSS VARIABLES & RESET ===== */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --text-color: #333;
            --bg-color: #fff;
            --card-bg: #f8f9fa;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --audio-color: #9b59b6;
        }

        .dark-mode {
            --primary-color: #34495e;
            --secondary-color: #2980b9;
            --text-color: #ecf0f1;
            --bg-color: #1a2530;
            --card-bg: #2c3e50;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --audio-color: #8e44ad;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== HEADER STYLES ===== */
        .app-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--box-shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 1.8rem;
            color: var(--secondary-color);
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: transparent;
            color: white;
            border: 1px solid transparent;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .nav-btn.active {
            background-color: var(--secondary-color);
        }

        .mode-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .mode-indicator {
            background: var(--secondary-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .countdown-timer {
            background: var(--warning-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            display: none;
        }

        /* Timer Progress Bar Styles */
        .timer-progress {
            height: 4px;
            background-color: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            width: 100%;
        }

        .timer-bar {
            height: 100%;
            background-color: var(--secondary-color);
            width: 0%;
            transition: width 1s linear;
        }

        /* User Profile Styles */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .user-name {
            color: white;
            font-weight: 500;
        }

        /* ===== BUTTON STYLES ===== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid #ddd;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary-color);
            color: var(--secondary-color);
        }

        .btn-outline:hover {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-audio {
            background: var(--audio-color);
            color: white;
        }

        .btn-audio:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        /* ===== MAIN CONTENT STYLES ===== */
        .app-view {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .app-view.active {
            display: block;
        }

        .verse-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            margin: 20px 0;
            box-shadow: var(--box-shadow);
            text-align: center;
            transition: var(--transition);
        }

        .verse-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .verse-display {
            font-size: 1.3rem;
            line-height: 1.8;
            margin: 25px 0;
            padding: 25px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
            position: relative;
            transition: var(--transition);
        }

        .verse-reference {
            font-size: 1.1rem;
            color: var(--secondary-color);
            font-weight: 600;
            margin-top: 10px;
        }

        .verse-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .time-period {
            background: var(--primary-color);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .translation {
            color: var(--text-color);
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        /* ===== AUDIO BIBLE STYLES ===== */
        .audio-player-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--box-shadow);
            border-left: 4px solid var(--audio-color);
        }

        .audio-player {
            background: linear-gradient(135deg, var(--audio-color), #8e44ad);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .audio-main-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .audio-secondary-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .audio-progress {
            flex: 1;
            margin: 0 15px;
        }

        .progress-bar {
            height: 6px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            height: 100%;
            background-color: white;
            border-radius: 3px;
            transition: width 0.1s linear;
            width: 0%;
        }

        .progress-time {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .audio-verse-info {
            text-align: center;
            margin-bottom: 15px;
        }

        .audio-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .audio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .audio-option:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .audio-option.active {
            background: rgba(255, 255, 255, 0.4);
        }

        /* ===== READING PLANS STYLES ===== */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .plan-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .plan-card.featured {
            border-color: var(--secondary-color);
            transform: scale(1.02);
        }

        .plan-card:hover {
            transform: translateY(-5px);
        }

        .plan-card.featured:hover {
            transform: scale(1.02) translateY(-5px);
        }

        .plan-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .plan-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .plan-badge {
            background: var(--success-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .plan-progress {
            margin: 15px 0;
        }

        .plan-stats {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }

        .plan-stat {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* ===== SEARCH STYLES ===== */
        .search-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--box-shadow);
        }

        .search-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 20px;
            align-items: end;
        }

        .search-results {
            max-height: 600px;
            overflow-y: auto;
        }

        .search-result-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-result-item:hover {
            background-color: rgba(0, 0, 0, 0.03);
            transform: translateX(5px);
        }

        .result-reference {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .result-text {
            font-style: italic;
            margin-bottom: 5px;
        }

        .result-translation {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .search-filters {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ===== NOTES & HIGHLIGHTS STYLES ===== */
        .notes-highlights-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--box-shadow);
        }

        .tools-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab-btn.active {
            border-bottom-color: var(--secondary-color);
            color: var(--secondary-color);
        }

        .tab-content {
            display: none;
            animation: slideIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Highlight Colors */
        .highlight-colors {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .color-option.active {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }

        .color-yellow { background-color: #f1c40f; }
        .color-blue { background-color: #3498db; }
        .color-green { background-color: #2ecc71; }
        .color-pink { background-color: #e84393; }
        .color-orange { background-color: #e67e22; }

        /* Notes List */
        .notes-list, .highlights-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .note-item, .highlight-item {
            background: var(--bg-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--secondary-color);
            transition: var(--transition);
        }

        .note-item:hover, .highlight-item:hover {
            transform: translateX(5px);
        }

        .note-reference, .highlight-reference {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .note-date, .highlight-date {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* ===== USER STATS ===== */
        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
        }

        /* ===== LOADING STATES ===== */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        /* ===== MODAL STYLES ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--box-shadow);
            animation: slideUp 0.3s ease;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* ===== NOTIFICATION STYLES ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            z-index: 1001;
            box-shadow: var(--box-shadow);
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .nav-tabs {
                justify-content: center;
            }
            
            .verse-display {
                font-size: 1.1rem;
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons .btn {
                width: 100%;
                justify-content: center;
            }

            .plans-grid {
                grid-template-columns: 1fr;
            }

            .plan-stats {
                flex-direction: column;
                gap: 10px;
            }

            .timer-progress {
                margin-bottom: 1rem;
            }

            .user-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .search-controls {
                grid-template-columns: 1fr;
            }

            .audio-controls {
                flex-direction: column;
            }

            .audio-progress {
                width: 100%;
                margin: 10px 0;
            }
        }

        @media (max-width: 480px) {
            .verse-section {
                padding: 20px;
            }
            
            .verse-display {
                font-size: 1rem;
                padding: 15px;
            }
            
            .modal-content {
                padding: 20px;
            }

            .mode-controls {
                flex-direction: column;
                width: 100%;
            }

            .timer-progress {
                order: -1;
                margin-bottom: 0.5rem;
            }

            .user-stats {
                grid-template-columns: 1fr;
            }

            .nav-btn {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .audio-options {
                flex-direction: column;
                align-items: center;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-muted { opacity: 0.7; }
        .mt-1 { margin-top: 10px; }
        .mt-2 { margin-top: 20px; }
        .mb-1 { margin-bottom: 10px; }
        .mb-2 { margin-bottom: 20px; }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease; }
    </style>
</head>
<body>
    <!-- ===== HEADER ===== -->
    <header class="app-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-book-bible"></i>
                    <h1>VerseCurator</h1>
                </div>
                
                <nav class="nav-tabs">
                    <button class="nav-btn active" data-view="bible-reader">
                        <i class="fas fa-book-open"></i> Read
                    </button>
                    <button class="nav-btn" data-view="reading-plans">
                        <i class="fas fa-calendar-check"></i> Plans
                    </button>
                    <button class="nav-btn" data-view="audio-bible">
                        <i class="fas fa-headphones"></i> Audio
                    </button>
                    <button class="nav-btn" data-view="search">
                        <i class="fas fa-search"></i> Search
                    </button>
                    <button class="nav-btn" data-view="study-tools">
                        <i class="fas fa-tools"></i> Study
                    </button>
                </nav>
                
                <div class="mode-controls">
                    <div class="mode-indicator" id="modeIndicator">Auto Mode</div>
                    <div class="countdown-timer" id="countdownTimer">Returning to Auto: 60s</div>
                    
                    <!-- Timer Progress Bar -->
                    <div class="timer-progress">
                        <div class="timer-bar" id="timerBar"></div>
                    </div>
                    
                    <!-- User Profile or Login Button -->
                    <div id="userSection">
                        <button class="btn btn-outline" id="loginBtn">
                            <i class="fas fa-user"></i> Sign In
                        </button>
                    </div>
                    
                    <button class="btn btn-outline" id="themeToggle">
                        <i class="fas fa-moon"></i> Theme
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="container">
        <!-- Bible Reader View -->
        <section id="bible-reader" class="app-view active">
            <div class="verse-section">
                <div class="verse-display" id="verseText">
                    "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life."
                </div>
                <div class="verse-reference" id="verseReference">John 3:16</div>
                
                <div class="verse-meta">
                    <div class="time-period" id="timePeriod">Morning</div>
                    <div class="translation" id="translation">NIV</div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="shareVerse">
                        <i class="fas fa-share"></i> Share Verse
                    </button>
                    <button class="btn btn-secondary" id="viewHistory">
                        <i class="fas fa-history"></i> History
                    </button>
                    <button class="btn btn-outline" id="toggleMode">
                        <i class="fas fa-cog"></i> Switch to Manual
                    </button>
                    <button class="btn btn-success" id="addNoteBtn">
                        <i class="fas fa-sticky-note"></i> Add Note
                    </button>
                    <button class="btn btn-audio" id="playVerseAudio">
                        <i class="fas fa-play"></i> Play Audio
                    </button>
                </div>

                <!-- Highlight Colors -->
                <div class="highlight-options">
                    <span style="font-weight: 500;">Highlight Color:</span>
                    <div class="highlight-colors">
                        <div class="color-option color-yellow active" data-color="yellow" data-hex="#f1c40f"></div>
                        <div class="color-option color-blue" data-color="blue" data-hex="#3498db"></div>
                        <div class="color-option color-green" data-color="green" data-hex="#2ecc71"></div>
                        <div class="color-option color-pink" data-color="pink" data-hex="#e84393"></div>
                        <div class="color-option color-orange" data-color="orange" data-hex="#e67e22"></div>
                    </div>
                    <button class="btn btn-outline" id="addHighlightBtn">
                        <i class="fas fa-highlighter"></i> Highlight Verse
                    </button>
                </div>

                <!-- Manual Mode Controls -->
                <div class="manual-controls hidden" id="manualControls">
                    <div class="action-buttons">
                        <button class="btn btn-outline" data-period="morning">Morning</button>
                        <button class="btn btn-outline" data-period="day">Day</button>
                        <button class="btn btn-outline" data-period="afternoon">Afternoon</button>
                        <button class="btn btn-outline" data-period="evening">Evening</button>
                        <button class="btn btn-outline" data-period="night">Night</button>
                    </div>
                </div>
            </div>

            <!-- User Stats Section -->
            <section class="user-stats hidden" id="userStatsSection">
                <div class="stat-card">
                    <div class="stat-value" id="streakCount">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="notesCount">0</div>
                    <div class="stat-label">Notes Created</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="highlightsCount">0</div>
                    <div class="stat-label">Verses Highlighted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="versesRead">0</div>
                    <div class="stat-label">Verses Read</div>
                </div>
            </section>
        </section>

        <!-- Reading Plans View -->
        <section id="reading-plans" class="app-view">
            <div class="verse-section">
                <h2>Bible Reading Plans</h2>
                <p class="text-muted">Choose a plan to guide your daily Bible reading</p>
                
                <div class="plans-grid">
                    <!-- Bible in a Year Plan -->
                    <div class="plan-card featured">
                        <div class="plan-header">
                            <div class="plan-title">Bible in a Year</div>
                            <div class="plan-badge">Featured</div>
                        </div>
                        <p>Read through the entire Bible in 365 days with carefully selected daily readings.</p>
                        
                        <div class="plan-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="yearPlanProgress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span>Progress</span>
                                <span id="yearPlanPercent">0%</span>
                            </div>
                        </div>
                        
                        <div class="plan-stats">
                            <div class="plan-stat">
                                <div class="stat-value" id="yearPlanDays">0</div>
                                <div class="stat-label">Days Completed</div>
                            </div>
                            <div class="plan-stat">
                                <div class="stat-value" id="yearPlanStreak">0</div>
                                <div class="stat-label">Current Streak</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="startYearPlan" style="width: 100%;">
                            <i class="fas fa-play"></i> Start Reading Plan
                        </button>
                    </div>

                    <!-- New Testament Plan -->
                    <div class="plan-card">
                        <div class="plan-header">
                            <div class="plan-title">New Testament in 90 Days</div>
                        </div>
                        <p>Focus on the New Testament with this intensive 90-day reading plan.</p>
                        
                        <div class="plan-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="ntPlanProgress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span>Progress</span>
                                <span id="ntPlanPercent">0%</span>
                            </div>
                        </div>
                        
                        <div class="plan-stats">
                            <div class="plan-stat">
                                <div class="stat-value" id="ntPlanDays">0</div>
                                <div class="stat-label">Days Completed</div>
                            </div>
                            <div class="plan-stat">
                                <div class="stat-value" id="ntPlanStreak">0</div>
                                <div class="stat-label">Current Streak</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-outline" id="startNTPlan" style="width: 100%;">
                            <i class="fas fa-play"></i> Start Reading Plan
                        </button>
                    </div>

                    <!-- Psalms & Proverbs Plan -->
                    <div class="plan-card">
                        <div class="plan-header">
                            <div class="plan-title">Psalms & Proverbs</div>
                        </div>
                        <p>30-day journey through the wisdom and worship of Psalms and Proverbs.</p>
                        
                        <div class="plan-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="psalmsPlanProgress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span>Progress</span>
                                <span id="psalmsPlanPercent">0%</span>
                            </div>
                        </div>
                        
                        <div class="plan-stats">
                            <div class="plan-stat">
                                <div class="stat-value" id="psalmsPlanDays">0</div>
                                <div class="stat-label">Days Completed</div>
                            </div>
                            <div class="plan-stat">
                                <div class="stat-value" id="psalmsPlanStreak">0</div>
                                <div class="stat-label">Current Streak</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-outline" id="startPsalmsPlan" style="width: 100%;">
                            <i class="fas fa-play"></i> Start Reading Plan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Current Reading Progress -->
            <div class="verse-section hidden" id="currentReadingSection">
                <h3>Today's Reading</h3>
                <div id="todaysReading">
                    <p class="text-center text-muted">Select a reading plan to see today's reading</p>
                </div>
                <button class="btn btn-success" id="markAsRead">
                    <i class="fas fa-check"></i> Mark as Read
                </button>
            </div>
        </section>

        <!-- Audio Bible View -->
        <section id="audio-bible" class="app-view">
            <div class="audio-player-section">
                <h2>Audio Bible</h2>
                <p class="text-muted">Listen to God's Word with our immersive audio experience</p>

                <!-- Audio Player -->
                <div class="audio-player">
                    <div class="audio-verse-info">
                        <h3 id="audioCurrentVerse">John 3:16</h3>
                        <p id="audioCurrentText">For God so loved the world...</p>
                    </div>

                    <div class="audio-controls">
                        <div class="audio-main-controls">
                            <button class="btn btn-sm" id="audioPrev">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button class="btn" id="audioPlayPause">
                                <i class="fas fa-play"></i> Play
                            </button>
                            <button class="btn btn-sm" id="audioNext">
                                <i class="fas fa-step-forward"></i>
                            </button>
                        </div>

                        <div class="audio-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="audioProgress" style="width: 0%"></div>
                            </div>
                            <div class="progress-time">
                                <span id="audioCurrentTime">0:00</span>
                                <span id="audioDuration">0:00</span>
                            </div>
                        </div>

                        <div class="audio-secondary-controls">
                            <button class="btn btn-sm" id="audioSpeed">
                                <i class="fas fa-tachometer-alt"></i> 1.0x
                            </button>
                            <button class="btn btn-sm" id="audioSleep">
                                <i class="fas fa-moon"></i> Sleep
                            </button>
                        </div>
                    </div>

                    <div class="audio-options">
                        <div class="audio-option active" data-voice="male">
                            <i class="fas fa-male"></i> Male Voice
                        </div>
                        <div class="audio-option" data-voice="female">
                            <i class="fas fa-female"></i> Female Voice
                        </div>
                        <div class="audio-option" data-voice="dramatic">
                            <i class="fas fa-theater-masks"></i> Dramatic
                        </div>
                    </div>
                </div>

                <!-- Audio Library -->
                <div class="audio-library mt-2">
                    <h3>Audio Library</h3>
                    <div class="audio-list" id="audioList">
                        <div class="search-result-item" data-verse="John 3:16">
                            <div class="result-reference">John 3:16</div>
                            <div class="result-text">For God so loved the world that he gave his one and only Son...</div>
                            <button class="btn btn-sm btn-audio" onclick="app.playAudioVerse('John 3:16')">
                                <i class="fas fa-play"></i> Play
                            </button>
                        </div>
                        <div class="search-result-item" data-verse="Psalm 23:1">
                            <div class="result-reference">Psalm 23:1</div>
                            <div class="result-text">The Lord is my shepherd, I lack nothing.</div>
                            <button class="btn btn-sm btn-audio" onclick="app.playAudioVerse('Psalm 23:1')">
                                <i class="fas fa-play"></i> Play
                            </button>
                        </div>
                        <div class="search-result-item" data-verse="Philippians 4:13">
                            <div class="result-reference">Philippians 4:13</div>
                            <div class="result-text">I can do all this through him who gives me strength.</div>
                            <button class="btn btn-sm btn-audio" onclick="app.playAudioVerse('Philippians 4:13')">
                                <i class="fas fa-play"></i> Play
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Download Audio Section -->
            <div class="verse-section">
                <h3>Download Audio for Offline Use</h3>
                <p class="text-muted">Download complete books for listening without internet</p>
                
                <div class="action-buttons">
                    <button class="btn btn-outline" onclick="app.downloadAudio('matthew')">
                        <i class="fas fa-download"></i> Download Matthew
                    </button>
                    <button class="btn btn-outline" onclick="app.downloadAudio('psalms')">
                        <i class="fas fa-download"></i> Download Psalms
                    </button>
                    <button class="btn btn-outline" onclick="app.downloadAudio('john')">
                        <i class="fas fa-download"></i> Download John
                    </button>
                </div>
            </div>
        </section>

        <!-- Search View -->
        <section id="search" class="app-view">
            <div class="search-section">
                <h2>Search the Bible</h2>
                
                <div class="search-controls">
                    <div class="form-group">
                        <label for="searchQuery">Search for verses, keywords, or topics</label>
                        <input type="text" id="searchQuery" placeholder="e.g., love, John 3:16, forgiveness...">
                    </div>
                    
                    <div class="form-group">
                        <label for="searchVersion">Translation</label>
                        <select id="searchVersion">
                            <option value="all">All Translations</option>
                            <option value="niv">NIV</option>
                            <option value="esv">ESV</option>
                            <option value="kjv">KJV</option>
                            <option value="nasb">NASB</option>
                            <option value="nlt">NLT</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="searchBook">Book (Optional)</label>
                        <select id="searchBook">
                            <option value="all">All Books</option>
                            <option value="genesis">Genesis</option>
                            <option value="exodus">Exodus</option>
                            <option value="matthew">Matthew</option>
                            <option value="mark">Mark</option>
                            <option value="luke">Luke</option>
                            <option value="john">John</option>
                            <option value="romans">Romans</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" id="searchButton">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>

                <div class="search-filters">
                    <div class="filter-group">
                        <input type="checkbox" id="exactMatch">
                        <label for="exactMatch">Exact phrase</label>
                    </div>
                    <div class="filter-group">
                        <input type="checkbox" id="caseSensitive">
                        <label for="caseSensitive">Case sensitive</label>
                    </div>
                </div>

                <div class="search-results" id="searchResults">
                    <p class="text-center text-muted">Enter a search term to find Bible verses</p>
                </div>
            </div>

            <!-- Search History -->
            <div class="verse-section">
                <h3>Recent Searches</h3>
                <div id="searchHistory">
                    <p class="text-center text-muted">No recent searches</p>
                </div>
            </div>
        </section>

        <!-- Study Tools View -->
        <section id="study-tools" class="app-view">
            <div class="notes-highlights-section">
                <div class="tools-tabs">
                    <button class="tab-btn active" data-tab="notes">My Notes</button>
                    <button class="tab-btn" data-tab="highlights">My Highlights</button>
                    <button class="tab-btn" data-tab="profile">My Profile</button>
                </div>

                <!-- Notes Tab -->
                <div class="tab-content active" id="notes-content">
                    <div class="notes-list" id="notesList">
                        <p class="text-center text-muted">No notes yet. Create your first note!</p>
                    </div>
                </div>

                <!-- Highlights Tab -->
                <div class="tab-content" id="highlights-content">
                    <div class="highlights-list" id="highlightsList">
                        <p class="text-center text-muted">No highlights yet. Highlight verses to see them here!</p>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div class="tab-content" id="profile-content">
                    <div class="profile-info">
                        <h3>User Profile</h3>
                        <p class="text-muted">Manage your account and preferences</p>
                        
                        <div class="user-stats" style="margin: 20px 0;">
                            <div class="stat-card">
                                <div class="stat-value" id="profileStreak">0</div>
                                <div class="stat-label">Day Streak</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="profileNotes">0</div>
                                <div class="stat-label">Total Notes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="profileHighlights">0</div>
                                <div class="stat-label">Highlights</div>
                            </div>
                        </div>

                        <div class="profile-actions">
                            <button class="btn btn-outline" id="editProfileBtn">
                                <i class="fas fa-edit"></i> Edit Profile
                            </button>
                            <button class="btn btn-outline" id="exportDataBtn">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                            <button class="btn btn-danger" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ===== MODALS ===== -->
    
    <!-- Login/Register Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <h2 id="authModalTitle">Sign In to VerseCurator</h2>
            
            <div class="auth-tabs" style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ddd;">
                <button class="tab-btn active" data-auth="login">Sign In</button>
                <button class="tab-btn" data-auth="register">Create Account</button>
            </div>

            <div class="auth-content">
                <!-- Login Form -->
                <div id="login-form">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password">
                    </div>
                    <button class="btn btn-primary" id="loginSubmit" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </div>

                <!-- Register Form -->
                <div id="register-form" style="display: none;">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" placeholder="Create a password">
                    </div>
                    <div class="form-group">
                        <label for="registerConfirm">Confirm Password</label>
                        <input type="password" id="registerConfirm" placeholder="Confirm your password">
                    </div>
                    <button class="btn btn-primary" id="registerSubmit" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-outline" id="closeAuthModal">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Note Creation Modal -->
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <h3>Add Note to <span id="noteVerseReference">John 3:16</span></h3>
            <div class="form-group">
                <label for="noteTitle">Note Title (Optional)</label>
                <input type="text" id="noteTitle" placeholder="Enter a title for your note">
            </div>
            <div class="form-group">
                <label for="noteContent">Note Content</label>
                <textarea id="noteContent" placeholder="Write your thoughts, prayers, or insights about this verse..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelNote">Cancel</button>
                <button class="btn btn-primary" id="saveNote">Save Note</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <h2>Share Verse</h2>
            
            <div class="sharing-options">
                <!-- Text Sharing Options -->
                <div class="option-group">
                    <h3>Text Sharing</h3>
                    <label style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                        <input type="checkbox" id="hideAttribution">
                        <span>Hide app attribution</span>
                    </label>
                    <button class="btn btn-primary" id="shareText">
                        <i class="fas fa-share-alt"></i> Share as Text
                    </button>
                </div>

                <!-- Image Sharing Options -->
                <div class="option-group">
                    <h3>Image Sharing</h3>
                    <div class="theme-previews">
                        <div class="theme-preview active" data-theme="minimal" style="background: linear-gradient(135deg, #667eea, #764ba2);">Minimal</div>
                        <div class="theme-preview" data-theme="nature" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">Nature</div>
                        <div class="theme-preview" data-theme="abstract" style="background: linear-gradient(135deg, #f093fb, #f5576c);">Abstract</div>
                    </div>
                    <button class="btn btn-secondary" id="shareImage">
                        <i class="fas fa-image"></i> Share as Image
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-outline" id="closeShareModal">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Sleep Timer Modal -->
    <div class="modal" id="sleepTimerModal">
        <div class="modal-content">
            <h3>Sleep Timer</h3>
            <p class="text-muted">Set a timer to automatically stop audio playback</p>
            
            <div class="sleep-options" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0;">
                <button class="btn btn-outline" data-minutes="5">5 min</button>
                <button class="btn btn-outline" data-minutes="15">15 min</button>
                <button class="btn btn-outline" data-minutes="30">30 min</button>
                <button class="btn btn-outline" data-minutes="45">45 min</button>
                <button class="btn btn-outline" data-minutes="60">60 min</button>
                <button class="btn btn-outline" data-minutes="0">Off</button>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-outline" id="closeSleepTimer">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Notification Area -->
    <div id="notificationArea"></div>

    <!-- Audio Element (Hidden) -->
    <audio id="audioPlayer" preload="metadata"></audio>

    <script>
        // ===== VERSE CURATOR APP - PHASE 2.3 AUDIO & ENHANCEMENT =====
        class VerseCurator {
            constructor() {
                this.state = {
                    currentMode: 'auto',
                    currentPeriod: this.getCurrentTimePeriod(),
                    currentVerse: null,
                    history: [],
                    theme: 'light',
                    inactivityTimer: null,
                    autoRefreshTimer: null,
                    currentUser: null,
                    notes: [],
                    highlights: [],
                    userStats: {
                        streak: 0,
                        notesCount: 0,
                        highlightsCount: 0,
                        versesRead: 0,
                        lastReadDate: null
                    },
                    readingPlans: {
                        bibleInYear: {
                            active: false,
                            startDate: null,
                            completedDays: 0,
                            currentStreak: 0,
                            progress: 0
                        },
                        newTestament: {
                            active: false,
                            startDate: null,
                            completedDays: 0,
                            currentStreak: 0,
                            progress: 0
                        },
                        psalmsProverbs: {
                            active: false,
                            startDate: null,
                            completedDays: 0,
                            currentStreak: 0,
                            progress: 0
                        }
                    },
                    searchHistory: [],
                    audio: {
                        isPlaying: false,
                        currentTime: 0,
                        duration: 0,
                        playbackRate: 1.0,
                        currentVoice: 'male',
                        sleepTimer: null,
                        sleepMinutes: 0
                    }
                };

                // Audio database with simulated audio files
                this.audioDatabase = {
                    'John 3:16': {
                        text: 'For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.',
                        duration: 12
                    },
                    'Psalm 23:1': {
                        text: 'The Lord is my shepherd, I lack nothing.',
                        duration: 6
                    },
                    'Philippians 4:13': {
                        text: 'I can do all this through him who gives me strength.',
                        duration: 8
                    },
                    'Jeremiah 29:11': {
                        text: 'For I know the plans I have for you, declares the Lord, plans to prosper you and not to harm you, plans to give you hope and a future.',
                        duration: 15
                    }
                };

                // Extended verse database
                this.verseDatabase = {
                    morning: [
                        { reference: "Psalm 5:3", text: "In the morning, Lord, you hear my voice; in the morning I lay my requests before you and wait expectantly.", translation: "NIV" },
                        { reference: "Lamentations 3:22-23", text: "Because of the Lord's great love we are not consumed, for his compassions never fail. They are new every morning; great is your faithfulness.", translation: "NIV" }
                    ],
                    day: [
                        { reference: "Isaiah 40:31", text: "But those who hope in the Lord will renew their strength. They will soar on wings like eagles; they will run and not grow weary, they will walk and not be faint.", translation: "NIV" },
                        { reference: "Joshua 1:9", text: "Have I not commanded you? Be strong and courageous. Do not be afraid; do not be discouraged, for the Lord your God will be with you wherever you go.", translation: "NIV" }
                    ],
                    afternoon: [
                        { reference: "Philippians 4:6-7", text: "Do not be anxious about anything, but in every situation, by prayer and petition, with thanksgiving, present your requests to God. And the peace of God, which transcends all understanding, will guard your hearts and your minds in Christ Jesus.", translation: "NIV" },
                        { reference: "Matthew 11:28", text: "Come to me, all you who are weary and burdened, and I will give you rest.", translation: "NIV" }
                    ],
                    evening: [
                        { reference: "Psalm 127:2", text: "In vain you rise early and stay up late, toiling for food to eat for he grants sleep to those he loves.", translation: "NIV" },
                        { reference: "1 Thessalonians 5:18", text: "Give thanks in all circumstances; for this is God's will for you in Christ Jesus.", translation: "NIV" }
                    ],
                    night: [
                        { reference: "Psalm 4:8", text: "In peace I will lie down and sleep, for you alone, Lord, make me dwell in safety.", translation: "NIV" },
                        { reference: "Psalm 91:5-6", text: "You will not fear the terror of night, nor the arrow that flies by day, nor the pestilence that stalks in the darkness, nor the plague that destroys at midday.", translation: "NIV" }
                    ]
                };

                this.searchDatabase = [
                    { reference: "John 3:16", text: "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.", translation: "NIV" },
                    { reference: "1 John 4:8", text: "Whoever does not love does not know God, because God is love.", translation: "NIV" },
                    { reference: "1 Corinthians 13:4-5", text: "Love is patient, love is kind. It does not envy, it does not boast, it is not proud. It does not dishonor others, it is not self-seeking, it is not easily angered, it keeps no record of wrongs.", translation: "NIV" },
                    { reference: "Romans 5:8", text: "But God demonstrates his own love for us in this: While we were still sinners, Christ died for us.", translation: "NIV" },
                    { reference: "Psalm 23:1", text: "The Lord is my shepherd, I lack nothing.", translation: "NIV" },
                    { reference: "Philippians 4:13", text: "I can do all this through him who gives me strength.", translation: "NIV" },
                    { reference: "Jeremiah 29:11", text: "For I know the plans I have for you,' declares the Lord, 'plans to prosper you and not to harm you, plans to give you hope and a future.", translation: "NIV" }
                ];

                this.readingPlanData = {
                    bibleInYear: [
                        { reference: "Genesis 1:1-2:25", text: "In the beginning God created the heavens and the earth...", description: "The story of creation" },
                        { reference: "Genesis 3:1-4:26", text: "Now the serpent was more crafty than any of the wild animals...", description: "The fall of man" }
                    ],
                    newTestament: [
                        { reference: "Matthew 1-2", text: "The genealogy and birth of Jesus Christ...", description: "The coming of the Messiah" },
                        { reference: "Matthew 3-4", text: "John the Baptist prepares the way, Jesus is baptized and tempted...", description: "The beginning of Jesus' ministry" }
                    ],
                    psalmsProverbs: [
                        { reference: "Psalm 1", text: "Blessed is the one who does not walk in step with the wicked...", description: "The way of the righteous" },
                        { reference: "Proverbs 1:1-7", text: "The proverbs of Solomon son of David, king of Israel...", description: "The purpose of Proverbs" }
                    ]
                };

                this.init();
            }

            init() {
                this.loadUserData();
                this.bindEvents();
                this.startAutoRefresh();
                this.loadRandomVerse();
                this.updateUI();
                this.checkLoginState();
                this.updateReadingPlansDisplay();
                this.initAudioPlayer();
            }

            // ===== AUDIO BIBLE SYSTEM =====

            initAudioPlayer() {
                this.audioElement = document.getElementById('audioPlayer');
                
                // Set up audio event listeners
                this.audioElement.addEventListener('loadedmetadata', () => {
                    this.state.audio.duration = this.audioElement.duration;
                    this.updateAudioDisplay();
                });

                this.audioElement.addEventListener('timeupdate', () => {
                    this.state.audio.currentTime = this.audioElement.currentTime;
                    this.updateAudioProgress();
                    
                    // Check sleep timer
                    if (this.state.audio.sleepMinutes > 0) {
                        const timeLeft = this.state.audio.sleepMinutes * 60 - this.state.audio.currentTime;
                        if (timeLeft <= 0) {
                            this.pauseAudio();
                            this.showNotification('Sleep timer ended - audio stopped', 'info');
                            this.clearSleepTimer();
                        }
                    }
                });

                this.audioElement.addEventListener('ended', () => {
                    this.state.audio.isPlaying = false;
                    this.updateAudioControls();
                    this.showNotification('Audio finished playing', 'info');
                });

                this.audioElement.addEventListener('error', (e) => {
                    console.error('Audio error:', e);
                    this.showNotification('Error playing audio', 'error');
                });
            }

            playAudioVerse(verseReference) {
                const audioData = this.audioDatabase[verseReference];
                if (!audioData) {
                    this.showNotification('Audio not available for this verse', 'warning');
                    return;
                }

                // Simulate audio loading
                this.showNotification(`Loading audio for ${verseReference}...`, 'info');
                
                // Update audio display
                document.getElementById('audioCurrentVerse').textContent = verseReference;
                document.getElementById('audioCurrentText').textContent = audioData.text;

                // Simulate audio playback (in a real app, this would load actual audio files)
                this.state.audio.isPlaying = true;
                this.state.audio.duration = audioData.duration;
                this.state.audio.currentTime = 0;

                this.updateAudioControls();
                this.startAudioSimulation();

                this.showNotification(`Now playing: ${verseReference}`, 'success');
            }

            startAudioSimulation() {
                // Simulate audio playback progress
                const simulateProgress = () => {
                    if (this.state.audio.isPlaying && this.state.audio.currentTime < this.state.audio.duration) {
                        this.state.audio.currentTime += 0.1;
                        this.updateAudioProgress();
                        setTimeout(simulateProgress, 100);
                    } else if (this.state.audio.currentTime >= this.state.audio.duration) {
                        this.state.audio.isPlaying = false;
                        this.updateAudioControls();
                    }
                };
                simulateProgress();
            }

            playPauseAudio() {
                if (this.state.audio.isPlaying) {
                    this.pauseAudio();
                } else {
                    this.playAudio();
                }
            }

            playAudio() {
                if (!this.state.currentVerse) {
                    this.showNotification('No verse selected to play', 'warning');
                    return;
                }

                this.playAudioVerse(this.state.currentVerse.reference);
            }

            pauseAudio() {
                this.state.audio.isPlaying = false;
                this.updateAudioControls();
            }

            updateAudioControls() {
                const playPauseBtn = document.getElementById('audioPlayPause');
                const icon = playPauseBtn.querySelector('i');

                if (this.state.audio.isPlaying) {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                    playPauseBtn.classList.add('pulse');
                } else {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
                    playPauseBtn.classList.remove('pulse');
                }
            }

            updateAudioProgress() {
                const progress = document.getElementById('audioProgress');
                const currentTime = document.getElementById('audioCurrentTime');
                const duration = document.getElementById('audioDuration');

                const progressPercent = (this.state.audio.currentTime / this.state.audio.duration) * 100;
                progress.style.width = `${progressPercent}%`;

                currentTime.textContent = this.formatTime(this.state.audio.currentTime);
                duration.textContent = this.formatTime(this.state.audio.duration);
            }

            updateAudioDisplay() {
                this.updateAudioControls();
                this.updateAudioProgress();
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            changePlaybackSpeed() {
                const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
                const currentIndex = speeds.indexOf(this.state.audio.playbackRate);
                const nextIndex = (currentIndex + 1) % speeds.length;
                
                this.state.audio.playbackRate = speeds[nextIndex];
                document.getElementById('audioSpeed').innerHTML = `<i class="fas fa-tachometer-alt"></i> ${this.state.audio.playbackRate}x`;
                
                this.showNotification(`Playback speed: ${this.state.audio.playbackRate}x`, 'info');
            }

            setSleepTimer(minutes) {
                this.state.audio.sleepMinutes = minutes;
                
                if (minutes > 0) {
                    this.showNotification(`Sleep timer set for ${minutes} minutes`, 'success');
                } else {
                    this.showNotification('Sleep timer turned off', 'info');
                }
                
                document.getElementById('sleepTimerModal').style.display = 'none';
            }

            clearSleepTimer() {
                this.state.audio.sleepMinutes = 0;
            }

            openSleepTimer() {
                document.getElementById('sleepTimerModal').style.display = 'flex';
            }

            downloadAudio(book) {
                this.showNotification(`Downloading ${book} audio...`, 'info');
                
                // Simulate download progress
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    this.showNotification(`Downloading ${book}... ${progress}%`, 'info');
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        this.showNotification(`${book} audio downloaded successfully!`, 'success');
                    }
                }, 300);
            }

            // ===== ENHANCEMENT FEATURES =====

            // Enhanced notification system with better animations
            showNotification(message, type = 'success') {
                const notificationArea = document.getElementById('notificationArea');
                const notification = document.createElement('div');
                notification.className = `notification fade-in`;
                notification.textContent = message;
                
                // Set color based on type
                if (type === 'error') {
                    notification.style.background = 'var(--danger-color)';
                } else if (type === 'warning') {
                    notification.style.background = 'var(--warning-color)';
                } else if (type === 'info') {
                    notification.style.background = 'var(--secondary-color)';
                } else {
                    notification.style.background = 'var(--success-color)';
                }
                
                notificationArea.appendChild(notification);
                
                // Enhanced removal with fade out
                setTimeout(() => {
                    notification.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 3000);
            }

            // Enhanced loading states
            setLoading(element, isLoading) {
                if (isLoading) {
                    element.classList.add('loading');
                    element.disabled = true;
                } else {
                    element.classList.remove('loading');
                    element.disabled = false;
                }
            }

            // ===== READING PLANS SYSTEM =====

            startReadingPlan(planName) {
                if (!this.state.currentUser) {
                    this.showNotification('Please sign in to start a reading plan', 'warning');
                    return;
                }

                this.state.readingPlans[planName] = {
                    active: true,
                    startDate: new Date().toISOString(),
                    completedDays: 0,
                    currentStreak: 0,
                    progress: 0
                };

                this.saveUserData();
                this.updateReadingPlansDisplay();
                this.showNotification(`Started ${this.getPlanDisplayName(planName)}!`, 'success');
                this.showTodaysReading(planName);
            }

            getPlanDisplayName(planKey) {
                const names = {
                    bibleInYear: 'Bible in a Year',
                    newTestament: 'New Testament in 90 Days',
                    psalmsProverbs: 'Psalms & Proverbs'
                };
                return names[planKey] || planKey;
            }

            updateReadingPlansDisplay() {
                // Update Bible in a Year plan
                const yearPlan = this.state.readingPlans.bibleInYear;
                document.getElementById('yearPlanProgress').style.width = `${yearPlan.progress}%`;
                document.getElementById('yearPlanPercent').textContent = `${yearPlan.progress}%`;
                document.getElementById('yearPlanDays').textContent = yearPlan.completedDays;
                document.getElementById('yearPlanStreak').textContent = yearPlan.currentStreak;

                // Update New Testament plan
                const ntPlan = this.state.readingPlans.newTestament;
                document.getElementById('ntPlanProgress').style.width = `${ntPlan.progress}%`;
                document.getElementById('ntPlanPercent').textContent = `${ntPlan.progress}%`;
                document.getElementById('ntPlanDays').textContent = ntPlan.completedDays;
                document.getElementById('ntPlanStreak').textContent = ntPlan.currentStreak;

                // Update Psalms & Proverbs plan
                const psalmsPlan = this.state.readingPlans.psalmsProverbs;
                document.getElementById('psalmsPlanProgress').style.width = `${psalmsPlan.progress}%`;
                document.getElementById('psalmsPlanPercent').textContent = `${psalmsPlan.progress}%`;
                document.getElementById('psalmsPlanDays').textContent = psalmsPlan.completedDays;
                document.getElementById('psalmsPlanStreak').textContent = psalmsPlan.currentStreak;

                // Show/hide current reading section
                const activePlan = this.getActivePlan();
                if (activePlan) {
                    document.getElementById('currentReadingSection').classList.remove('hidden');
                    this.showTodaysReading(activePlan);
                } else {
                    document.getElementById('currentReadingSection').classList.add('hidden');
                }
            }

            getActivePlan() {
                for (const [planName, plan] of Object.entries(this.state.readingPlans)) {
                    if (plan.active) {
                        return planName;
                    }
                }
                return null;
            }

            showTodaysReading(planName) {
                const planData = this.readingPlanData[planName];
                if (!planData || planData.length === 0) return;

                const todaysIndex = this.state.readingPlans[planName].completedDays;
                const reading = planData[todaysIndex] || planData[0];

                document.getElementById('todaysReading').innerHTML = `
                    <div class="verse-display">
                        <strong>${reading.reference}</strong>
                        <p>${reading.text}</p>
                        <p class="text-muted">${reading.description}</p>
                    </div>
                `;
            }

            markTodaysReading() {
                const activePlan = this.getActivePlan();
                if (!activePlan) return;

                const plan = this.state.readingPlans[activePlan];
                plan.completedDays++;
                plan.currentStreak++;
                
                // Calculate progress
                const totalDays = this.readingPlanData[activePlan].length;
                plan.progress = Math.min(100, Math.round((plan.completedDays / totalDays) * 100));

                this.saveUserData();
                this.updateReadingPlansDisplay();
                this.showNotification('Today\'s reading marked as complete!', 'success');
            }

            // ===== ADVANCED SEARCH SYSTEM =====

            performSearch() {
                const query = document.getElementById('searchQuery').value.trim();
                const version = document.getElementById('searchVersion').value;
                const book = document.getElementById('searchBook').value;
                const exactMatch = document.getElementById('exactMatch').checked;
                const caseSensitive = document.getElementById('caseSensitive').checked;

                if (!query) {
                    this.showNotification('Please enter a search term', 'warning');
                    return;
                }

                // Add to search history
                this.addToSearchHistory(query);
                this.showNotification(`Searching for "${query}"...`, 'info');

                // Simulate search with timeout
                setTimeout(() => {
                    const results = this.executeSearch(query, version, book, exactMatch, caseSensitive);
                    this.displaySearchResults(results);
                }, 800);
            }

            executeSearch(query, version, book, exactMatch, caseSensitive) {
                let results = this.searchDatabase.filter(verse => {
                    let searchText = caseSensitive ? verse.text : verse.text.toLowerCase();
                    let searchQuery = caseSensitive ? query : query.toLowerCase();

                    // Check version filter
                    if (version !== 'all' && verse.translation.toLowerCase() !== version.toLowerCase()) {
                        return false;
                    }

                    // Check book filter
                    if (book !== 'all') {
                        const verseBook = verse.reference.split(' ')[0].toLowerCase();
                        if (!verseBook.includes(book.toLowerCase())) {
                            return false;
                        }
                    }

                    // Check text match
                    if (exactMatch) {
                        return searchText.includes(searchQuery);
                    } else {
                        const words = searchQuery.split(' ');
                        return words.every(word => searchText.includes(word));
                    }
                });

                return results;
            }

            displaySearchResults(results) {
                const resultsContainer = document.getElementById('searchResults');

                if (results.length === 0) {
                    resultsContainer.innerHTML = '<p class="text-center text-muted">No verses found matching your search.</p>';
                    return;
                }

                let html = '';
                results.forEach(verse => {
                    html += `
                        <div class="search-result-item" data-reference="${verse.reference}">
                            <div class="result-reference">${verse.reference}</div>
                            <div class="result-text">"${verse.text}"</div>
                            <div class="result-translation">${verse.translation}</div>
                        </div>
                    `;
                });

                resultsContainer.innerHTML = html;

                // Add click handlers to search results
                resultsContainer.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const reference = item.getAttribute('data-reference');
                        this.loadVerseByReference(reference);
                        this.switchView('bible-reader');
                        this.showNotification(`Now viewing ${reference}`, 'success');
                    });
                });
            }

            addToSearchHistory(query) {
                this.state.searchHistory.unshift({
                    query: query,
                    timestamp: new Date().toISOString()
                });

                // Keep only last 10 searches
                if (this.state.searchHistory.length > 10) {
                    this.state.searchHistory = this.state.searchHistory.slice(0, 10);
                }

                this.saveUserData();
                this.renderSearchHistory();
            }

            renderSearchHistory() {
                const historyContainer = document.getElementById('searchHistory');

                if (this.state.searchHistory.length === 0) {
                    historyContainer.innerHTML = '<p class="text-center text-muted">No recent searches</p>';
                    return;
                }

                let html = '';
                this.state.searchHistory.forEach(search => {
                    html += `
                        <div class="search-result-item" style="cursor: pointer;">
                            <div class="result-reference">${search.query}</div>
                            <div class="result-translation">${new Date(search.timestamp).toLocaleDateString()}</div>
                        </div>
                    `;
                });

                historyContainer.innerHTML = html;

                // Add click handlers to search history
                historyContainer.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const query = item.querySelector('.result-reference').textContent;
                        document.getElementById('searchQuery').value = query;
                        this.performSearch();
                    });
                });
            }

            loadVerseByReference(reference) {
                // Find verse in search database
                const verse = this.searchDatabase.find(v => v.reference === reference);
                if (verse) {
                    this.state.currentVerse = verse;
                    this.renderVerse();
                }
            }

            // ===== USER ACCOUNT SYSTEM =====

            checkLoginState() {
                const userData = localStorage.getItem('verseCuratorUser');
                if (userData) {
                    this.state.currentUser = JSON.parse(userData);
                    this.updateUserInterface();
                }
            }

            registerUser(name, email, password) {
                const user = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    joinDate: new Date().toISOString(),
                    avatar: this.generateAvatar(name)
                };

                localStorage.setItem('verseCuratorUser', JSON.stringify(user));
                localStorage.setItem('verseCuratorUserStats', JSON.stringify(this.state.userStats));
                localStorage.setItem('verseCuratorReadingPlans', JSON.stringify(this.state.readingPlans));
                localStorage.setItem('verseCuratorAudioSettings', JSON.stringify(this.state.audio));
                
                this.state.currentUser = user;
                this.updateUserInterface();
                this.showNotification(`Welcome to VerseCurator, ${name}!`, 'success');
            }

            loginUser(email, password) {
                const user = {
                    id: 1,
                    name: "Demo User",
                    email: email,
                    joinDate: new Date().toISOString(),
                    avatar: this.generateAvatar("Demo User")
                };

                localStorage.setItem('verseCuratorUser', JSON.stringify(user));
                
                // Load user-specific data
                const savedStats = localStorage.getItem('verseCuratorUserStats');
                if (savedStats) {
                    this.state.userStats = JSON.parse(savedStats);
                }

                const savedNotes = localStorage.getItem('verseCuratorNotes');
                if (savedNotes) {
                    this.state.notes = JSON.parse(savedNotes);
                }

                const savedHighlights = localStorage.getItem('verseCuratorHighlights');
                if (savedHighlights) {
                    this.state.highlights = JSON.parse(savedHighlights);
                }

                const savedPlans = localStorage.getItem('verseCuratorReadingPlans');
                if (savedPlans) {
                    this.state.readingPlans = JSON.parse(savedPlans);
                }

                const savedSearchHistory = localStorage.getItem('verseCuratorSearchHistory');
                if (savedSearchHistory) {
                    this.state.searchHistory = JSON.parse(savedSearchHistory);
                }

                const savedAudioSettings = localStorage.getItem('verseCuratorAudioSettings');
                if (savedAudioSettings) {
                    this.state.audio = { ...this.state.audio, ...JSON.parse(savedAudioSettings) };
                }

                this.state.currentUser = user;
                this.updateUserInterface();
                this.updateReadingPlansDisplay();
                this.renderSearchHistory();
                this.updateAudioControls();
                this.showNotification(`Welcome back, ${user.name}!`, 'success');
            }

            logoutUser() {
                this.state.currentUser = null;
                localStorage.removeItem('verseCuratorUser');
                this.updateUserInterface();
                this.showNotification('You have been signed out.', 'info');
            }

            generateAvatar(name) {
                const names = name.split(' ');
                let initials = '';
                if (names.length > 1) {
                    initials = names[0][0] + names[1][0];
                } else {
                    initials = names[0][0];
                }
                return initials.toUpperCase();
            }

            updateUserInterface() {
                const userSection = document.getElementById('userSection');
                const userStatsSection = document.getElementById('userStatsSection');

                if (this.state.currentUser) {
                    userSection.innerHTML = `
                        <div class="user-profile">
                            <div class="user-avatar">${this.state.currentUser.avatar}</div>
                            <span class="user-name">${this.state.currentUser.name}</span>
                        </div>
                    `;
                    userStatsSection.classList.remove('hidden');
                    this.updateUserStats();
                    this.renderNotes();
                    this.renderHighlights();
                } else {
                    userSection.innerHTML = `
                        <button class="btn btn-outline" id="loginBtn">
                            <i class="fas fa-user"></i> Sign In
                        </button>
                    `;
                    userStatsSection.classList.add('hidden');
                    
                    // Re-bind login button
                    document.getElementById('loginBtn').addEventListener('click', () => {
                        this.openAuthModal();
                    });
                }
            }

            updateUserStats() {
                document.getElementById('streakCount').textContent = this.state.userStats.streak;
                document.getElementById('notesCount').textContent = this.state.notes.length;
                document.getElementById('highlightsCount').textContent = this.state.highlights.length;
                document.getElementById('versesRead').textContent = this.state.userStats.versesRead;

                // Update profile stats
                document.getElementById('profileStreak').textContent = this.state.userStats.streak;
                document.getElementById('profileNotes').textContent = this.state.notes.length;
                document.getElementById('profileHighlights').textContent = this.state.highlights.length;
            }

            // ===== NOTES SYSTEM =====

            addNote(title, content) {
                if (!this.state.currentUser) {
                    this.showNotification('Please sign in to create notes', 'warning');
                    return;
                }

                const note = {
                    id: Date.now(),
                    userId: this.state.currentUser.id,
                    verseReference: this.state.currentVerse.reference,
                    verseText: this.state.currentVerse.text,
                    title: title,
                    content: content,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                this.state.notes.unshift(note);
                this.saveUserData();
                this.renderNotes();
                this.updateUserStats();
                this.showNotification('Note saved successfully!', 'success');
            }

            renderNotes() {
                const notesList = document.getElementById('notesList');
                
                if (this.state.notes.length === 0) {
                    notesList.innerHTML = '<p class="text-center text-muted">No notes yet. Create your first note!</p>';
                    return;
                }

                let html = '';
                this.state.notes.forEach(note => {
                    html += `
                        <div class="note-item">
                            <div class="note-reference">${note.verseReference}</div>
                            ${note.title ? `<h4>${note.title}</h4>` : ''}
                            <p>${note.content}</p>
                            <div class="note-date">${new Date(note.createdAt).toLocaleDateString()}</div>
                        </div>
                    `;
                });
                
                notesList.innerHTML = html;
            }

            // ===== HIGHLIGHTS SYSTEM =====

            addHighlight() {
                if (!this.state.currentUser) {
                    this.showNotification('Please sign in to highlight verses', 'warning');
                    return;
                }

                const activeColor = document.querySelector('.color-option.active');
                const color = activeColor.getAttribute('data-color');
                const colorHex = activeColor.getAttribute('data-hex');

                const highlight = {
                    id: Date.now(),
                    userId: this.state.currentUser.id,
                    verseReference: this.state.currentVerse.reference,
                    verseText: this.state.currentVerse.text,
                    color: color,
                    colorHex: colorHex,
                    createdAt: new Date().toISOString()
                };

                this.state.highlights.unshift(highlight);
                this.saveUserData();
                this.renderHighlights();
                this.updateUserStats();
                this.showNotification(`Verse highlighted in ${color}!`, 'success');
            }

            renderHighlights() {
                const highlightsList = document.getElementById('highlightsList');
                
                if (this.state.highlights.length === 0) {
                    highlightsList.innerHTML = '<p class="text-center text-muted">No highlights yet. Highlight verses to see them here!</p>';
                    return;
                }

                let html = '';
                this.state.highlights.forEach(highlight => {
                    html += `
                        <div class="highlight-item">
                            <div class="highlight-reference">${highlight.verseReference}</div>
                            <div style="border-left: 4px solid ${highlight.colorHex}; padding-left: 10px; margin: 5px 0;">
                                <p>${highlight.verseText}</p>
                            </div>
                            <div class="highlight-date" style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${highlight.colorHex};"></div>
                                ${new Date(highlight.createdAt).toLocaleDateString()}
                            </div>
                        </div>
                    `;
                });
                
                highlightsList.innerHTML = html;
            }

            // ===== CORE FUNCTIONALITY =====

            getCurrentTimePeriod() {
                const hour = new Date().getHours();
                if (hour >= 5 && hour < 12) return 'morning';
                if (hour >= 12 && hour < 15) return 'day';
                if (hour >= 15 && hour < 18) return 'afternoon';
                if (hour >= 18 && hour < 22) return 'evening';
                return 'night';
            }

            loadRandomVerse() {
                const period = this.state.currentMode === 'auto' ? this.getCurrentTimePeriod() : this.state.currentPeriod;
                const verses = this.verseDatabase[period];
                
                if (verses && verses.length > 0) {
                    const randomIndex = Math.floor(Math.random() * verses.length);
                    this.state.currentVerse = verses[randomIndex];
                    this.renderVerse();
                    this.addToHistory(this.state.currentVerse);
                    
                    // Update user stats
                    if (this.state.currentUser) {
                        this.state.userStats.versesRead++;
                        this.updateStreak();
                        this.saveUserData();
                    }
                }
            }

            updateStreak() {
                const today = new Date().toDateString();
                const lastRead = this.state.userStats.lastReadDate;
                
                if (!lastRead) {
                    this.state.userStats.streak = 1;
                } else {
                    const lastReadDate = new Date(lastRead);
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (lastReadDate.toDateString() === yesterday.toDateString()) {
                        this.state.userStats.streak++;
                    } else if (lastReadDate.toDateString() !== today) {
                        this.state.userStats.streak = 1;
                    }
                }
                
                this.state.userStats.lastReadDate = today;
            }

            renderVerse() {
                if (this.state.currentVerse) {
                    document.getElementById('verseText').textContent = `"${this.state.currentVerse.text}"`;
                    document.getElementById('verseReference').textContent = this.state.currentVerse.reference;
                    document.getElementById('translation').textContent = this.state.currentVerse.translation;
                    document.getElementById('noteVerseReference').textContent = this.state.currentVerse.reference;
                    
                    const periodNames = {
                        morning: 'Morning',
                        day: 'Day', 
                        afternoon: 'Afternoon',
                        evening: 'Evening',
                        night: 'Night'
                    };
                    document.getElementById('timePeriod').textContent = periodNames[this.state.currentPeriod];
                }
            }

            // ===== VIEW MANAGEMENT =====

            switchView(viewName) {
                // Update navigation
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
                
                // Update views
                document.querySelectorAll('.app-view').forEach(view => {
                    view.classList.remove('active');
                });
                document.getElementById(viewName).classList.add('active');
            }

            // ===== MODE MANAGEMENT =====

            toggleMode() {
                if (this.state.currentMode === 'auto') {
                    this.switchToManualMode();
                } else {
                    this.switchToAutoMode();
                }
            }

            switchToManualMode() {
                this.state.currentMode = 'manual';
                document.getElementById('modeIndicator').textContent = 'Manual Mode';
                document.getElementById('toggleMode').innerHTML = '<i class="fas fa-sync"></i> Switch to Auto';
                document.getElementById('manualControls').classList.remove('hidden');
                this.startInactivityTimer();
                this.showNotification('Manual mode activated. Auto-return in 60 seconds.');
            }

            switchToAutoMode() {
                this.state.currentMode = 'auto';
                this.state.currentPeriod = this.getCurrentTimePeriod();
                document.getElementById('modeIndicator').textContent = 'Auto Mode';
                document.getElementById('toggleMode').innerHTML = '<i class="fas fa-cog"></i> Switch to Manual';
                document.getElementById('manualControls').classList.add('hidden');
                document.getElementById('countdownTimer').style.display = 'none';
                document.getElementById('timerBar').style.width = '0%';
                this.clearInactivityTimer();
                this.loadRandomVerse();
                this.showNotification('Auto mode activated.');
            }

            setManualPeriod(period) {
                this.state.currentPeriod = period;
                this.loadRandomVerse();
                this.resetInactivityTimer();
                this.showNotification(`Manual period set to: ${period}`);
            }

            // ===== TIMER MANAGEMENT =====

            startAutoRefresh() {
                this.state.autoRefreshTimer = setInterval(() => {
                    if (this.state.currentMode === 'auto') {
                        this.loadRandomVerse();
                    }
                }, 60000);
            }

            startInactivityTimer() {
                this.resetInactivityTimer();
            }

            resetInactivityTimer() {
                this.clearInactivityTimer();
                
                let seconds = 60;
                const updateTimer = () => {
                    document.getElementById('countdownTimer').textContent = `Returning to Auto: ${seconds}s`;
                    document.getElementById('countdownTimer').style.display = 'block';
                    document.getElementById('timerBar').style.width = `${(seconds / 60) * 100}%`;
                    
                    if (seconds <= 0) {
                        this.switchToAutoMode();
                        return;
                    }
                    
                    seconds--;
                    this.state.inactivityTimer = setTimeout(updateTimer, 1000);
                };
                
                updateTimer();
            }

            clearInactivityTimer() {
                if (this.state.inactivityTimer) {
                    clearTimeout(this.state.inactivityTimer);
                    this.state.inactivityTimer = null;
                }
            }

            // ===== HISTORY MANAGEMENT =====

            addToHistory(verse) {
                const historyItem = {
                    ...verse,
                    timestamp: new Date().toISOString(),
                    id: Date.now()
                };
                
                this.state.history.unshift(historyItem);
                
                if (this.state.history.length > 50) {
                    this.state.history = this.state.history.slice(0, 50);
                }
                
                this.renderHistory();
            }

            renderHistory() {
                const historyList = document.getElementById('historyList');
                
                if (this.state.history.length === 0) {
                    historyList.innerHTML = '<p class="text-center text-muted">No verse history yet.</p>';
                    return;
                }
                
                let html = '';
                this.state.history.forEach(item => {
                    html += `
                        <div class="history-item">
                            <div class="verse-text">"${item.text}"</div>
                            <div class="verse-reference">${item.reference} (${item.translation})</div>
                            <div class="text-muted" style="font-size: 0.8rem; margin-top: 5px;">
                                ${new Date(item.timestamp).toLocaleString()}
                            </div>
                            <div class="history-actions">
                                <button class="btn btn-outline" onclick="app.reshareVerse(${item.id})" style="font-size: 0.8rem;">
                                    <i class="fas fa-share"></i> Re-share
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                historyList.innerHTML = html;
            }

            reshareVerse(verseId) {
                const verse = this.state.history.find(item => item.id === verseId);
                if (verse) {
                    this.state.currentVerse = verse;
                    this.openShareModal();
                }
            }

            // ===== SHARING FUNCTIONALITY =====

            openShareModal() {
                document.getElementById('shareModal').style.display = 'flex';
            }

            shareAsText() {
                const hideAttribution = document.getElementById('hideAttribution').checked;
                const verse = this.state.currentVerse;
                
                let shareText = `"${verse.text}" - ${verse.reference}`;
                if (!hideAttribution) {
                    shareText += ' (Shared via VerseCurator)';
                }
                
                this.copyToClipboard(shareText);
                document.getElementById('shareModal').style.display = 'none';
                this.showNotification('Verse copied to clipboard!');
            }

            shareAsImage() {
                this.showNotification('Image sharing feature coming soon!');
                document.getElementById('shareModal').style.display = 'none';
            }

            copyToClipboard(text) {
                navigator.clipboard.writeText(text).catch(() => {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                });
            }

            // ===== MODAL MANAGEMENT =====

            openAuthModal() {
                document.getElementById('authModal').style.display = 'flex';
            }

            openNoteModal() {
                if (!this.state.currentUser) {
                    this.showNotification('Please sign in to create notes', 'warning');
                    return;
                }
                document.getElementById('noteModal').style.display = 'flex';
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').value = '';
            }

            // ===== UI MANAGEMENT =====

            toggleTheme() {
                this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
                document.body.classList.toggle('dark-mode');
                
                const icon = document.querySelector('#themeToggle i');
                icon.className = this.state.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
                
                this.saveUserData();
                this.showNotification(`${this.state.theme === 'light' ? 'Light' : 'Dark'} mode activated`);
            }

            updateUI() {
                this.renderVerse();
                
                if (this.state.theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.querySelector('#themeToggle i').className = 'fas fa-sun';
                }
            }

            // ===== DATA PERSISTENCE =====

            loadUserData() {
                const saved = localStorage.getItem('verseCuratorData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.state.history = data.history || [];
                    this.state.theme = data.theme || 'light';
                }
            }

            saveUserData() {
                const data = {
                    history: this.state.history,
                    theme: this.state.theme
                };
                localStorage.setItem('verseCuratorData', JSON.stringify(data));

                // Save user-specific data
                if (this.state.currentUser) {
                    localStorage.setItem('verseCuratorUserStats', JSON.stringify(this.state.userStats));
                    localStorage.setItem('verseCuratorNotes', JSON.stringify(this.state.notes));
                    localStorage.setItem('verseCuratorHighlights', JSON.stringify(this.state.highlights));
                    localStorage.setItem('verseCuratorReadingPlans', JSON.stringify(this.state.readingPlans));
                    localStorage.setItem('verseCuratorSearchHistory', JSON.stringify(this.state.searchHistory));
                    localStorage.setItem('verseCuratorAudioSettings', JSON.stringify(this.state.audio));
                }
            }

            // ===== EVENT BINDING =====

            bindEvents() {
                // Navigation
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const view = e.currentTarget.getAttribute('data-view');
                        this.switchView(view);
                    });
                });

                // Mode toggle
                document.getElementById('toggleMode').addEventListener('click', () => this.toggleMode());
                
                // Manual period buttons
                document.querySelectorAll('[data-period]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.setManualPeriod(e.target.dataset.period);
                    });
                });
                
                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
                
                // Share functionality
                document.getElementById('shareVerse').addEventListener('click', () => this.openShareModal());
                document.getElementById('shareText').addEventListener('click', () => this.shareAsText());
                document.getElementById('shareImage').addEventListener('click', () => this.shareAsImage());
                document.getElementById('closeShareModal').addEventListener('click', () => {
                    document.getElementById('shareModal').style.display = 'none';
                });
                
                // User authentication
                document.getElementById('loginBtn').addEventListener('click', () => this.openAuthModal());
                document.getElementById('closeAuthModal').addEventListener('click', () => {
                    document.getElementById('authModal').style.display = 'none';
                });

                // Auth tabs
                document.querySelectorAll('[data-auth]').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const authType = e.target.getAttribute('data-auth');
                        document.querySelectorAll('[data-auth]').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        if (authType === 'login') {
                            document.getElementById('login-form').style.display = 'block';
                            document.getElementById('register-form').style.display = 'none';
                            document.getElementById('authModalTitle').textContent = 'Sign In to VerseCurator';
                        } else {
                            document.getElementById('login-form').style.display = 'none';
                            document.getElementById('register-form').style.display = 'block';
                            document.getElementById('authModalTitle').textContent = 'Create Your Account';
                        }
                    });
                });

                // Login/Register forms
                document.getElementById('loginSubmit').addEventListener('click', () => {
                    const email = document.getElementById('loginEmail').value;
                    const password = document.getElementById('loginPassword').value;
                    if (email && password) {
                        this.loginUser(email, password);
                        document.getElementById('authModal').style.display = 'none';
                    } else {
                        this.showNotification('Please fill in all fields', 'warning');
                    }
                });

                document.getElementById('registerSubmit').addEventListener('click', () => {
                    const name = document.getElementById('registerName').value;
                    const email = document.getElementById('registerEmail').value;
                    const password = document.getElementById('registerPassword').value;
                    const confirm = document.getElementById('registerConfirm').value;
                    
                    if (name && email && password && confirm) {
                        if (password !== confirm) {
                            this.showNotification('Passwords do not match', 'error');
                            return;
                        }
                        this.registerUser(name, email, password);
                        document.getElementById('authModal').style.display = 'none';
                    } else {
                        this.showNotification('Please fill in all fields', 'warning');
                    }
                });

                // Notes functionality
                document.getElementById('addNoteBtn').addEventListener('click', () => this.openNoteModal());
                document.getElementById('cancelNote').addEventListener('click', () => {
                    document.getElementById('noteModal').style.display = 'none';
                });
                document.getElementById('saveNote').addEventListener('click', () => {
                    const title = document.getElementById('noteTitle').value;
                    const content = document.getElementById('noteContent').value;
                    if (content) {
                        this.addNote(title, content);
                        document.getElementById('noteModal').style.display = 'none';
                    } else {
                        this.showNotification('Please enter note content', 'warning');
                    }
                });

                // Highlights functionality
                document.querySelectorAll('.color-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.color-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        e.currentTarget.classList.add('active');
                    });
                });
                document.getElementById('addHighlightBtn').addEventListener('click', () => this.addHighlight());

                // Reading Plans functionality
                document.getElementById('startYearPlan').addEventListener('click', () => this.startReadingPlan('bibleInYear'));
                document.getElementById('startNTPlan').addEventListener('click', () => this.startReadingPlan('newTestament'));
                document.getElementById('startPsalmsPlan').addEventListener('click', () => this.startReadingPlan('psalmsProverbs'));
                document.getElementById('markAsRead').addEventListener('click', () => this.markTodaysReading());

                // Search functionality
                document.getElementById('searchButton').addEventListener('click', () => this.performSearch());
                document.getElementById('searchQuery').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });

                // Audio functionality
                document.getElementById('playVerseAudio').addEventListener('click', () => this.playAudio());
                document.getElementById('audioPlayPause').addEventListener('click', () => this.playPauseAudio());
                document.getElementById('audioSpeed').addEventListener('click', () => this.changePlaybackSpeed());
                document.getElementById('audioSleep').addEventListener('click', () => this.openSleepTimer());
                document.getElementById('closeSleepTimer').addEventListener('click', () => {
                    document.getElementById('sleepTimerModal').style.display = 'none';
                });

                // Sleep timer options
                document.querySelectorAll('[data-minutes]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const minutes = parseInt(e.target.getAttribute('data-minutes'));
                        this.setSleepTimer(minutes);
                    });
                });

                // Audio voice options
                document.querySelectorAll('.audio-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.audio-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        e.currentTarget.classList.add('active');
                        this.state.audio.currentVoice = e.currentTarget.getAttribute('data-voice');
                        this.showNotification(`Voice changed to ${this.state.audio.currentVoice}`, 'info');
                    });
                });

                // Tabs functionality
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tab = e.currentTarget.getAttribute('data-tab');
                        const parent = e.currentTarget.closest('.notes-highlights-section');
                        
                        parent.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        
                        parent.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        parent.querySelector(`#${tab}-content`).classList.add('active');
                    });
                });

                // Logout
                document.getElementById('logoutBtn').addEventListener('click', () => this.logoutUser());

                // Reset inactivity timer on user interaction
                document.addEventListener('click', () => {
                    if (this.state.currentMode === 'manual') {
                        this.resetInactivityTimer();
                    }
                });
                
                // Close modals on backdrop click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });

                // Escape key to close modals
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.style.display = 'none';
                        });
                    }
                });
            }
        }

        // Initialize the app
        const app = new VerseCurator();

        // Make app globally available
        window.app = app;
    </script>
</body>
</html>
